<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Happy Birthday üéâ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js" defer></script>
    <style>
      :root{
        --bg:#0b0f1a;--panel:#0f1524;--card:#11182a;--text:#e6e9f0;--muted:#9aa4b2;
        --pink:#ff6ec7;--blue:#7df9ff;--gold:#ffd166;--vio:#845ec2;
      }
      *{box-sizing:border-box}
      html,body{height:100%}
      body{
        margin:0;
        background:
          radial-gradient(1200px 800px at 70% -10%,rgba(125,249,255,.08),transparent),
          radial-gradient(900px 600px at 10% -20%,rgba(255,110,199,.08),transparent),
          var(--bg);
        color:var(--text);
        font-family:Poppins,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
        overflow-x:hidden;
      }
      a{color:inherit}
      .container{max-width:1100px;margin:0 auto;padding:clamp(16px,3vw,40px)}
      .center{display:grid;place-items:center}
      .hidden{opacity:0;transform:translateY(16px)}
      /* Screens */
      .screen{min-height:100svh;display:none;position:relative}
      .screen.active{display:block}
      /* Fixed backgrounds */
      canvas#stars, canvas#petalLayer{
        position:fixed;inset:0;z-index:0;pointer-events:none
      }
      /* Buttons + cards */
      .card{
        background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
        border:1px solid rgba(255,255,255,.08);
        border-radius:20px;padding:clamp(18px,3vw,28px);
        box-shadow:0 20px 60px rgba(0,0,0,.35);
      }
      .title{font-size:clamp(28px,4vw,40px);margin:0 0 8px}
      .btn{
        border:0;border-radius:14px;padding:14px 18px;
        background:linear-gradient(135deg,var(--pink),var(--blue));
        color:#071018;font-weight:800;letter-spacing:0.2px;cursor:pointer;
        box-shadow:0 16px 36px rgba(125,249,255,.18)
      }
      .btn.secondary{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.15)}
      /* Hero */
      .hero{display:grid;place-items:center;text-align:center;z-index:1}
      .greeting{
        font-family:"Great Vibes",cursive;font-size:clamp(52px,12vw,130px);line-height:1;
        background:linear-gradient(90deg,var(--gold),#fff,var(--blue));
        -webkit-background-clip:text;background-clip:text;color:transparent;
        filter:drop-shadow(0 6px 20px rgba(255,209,102,.22));
      }
      .subtitle{color:var(--muted)}
      .name-box{margin-top:28px;display:none}
      .input{
        background:#0e1526;border:1px solid rgba(255,255,255,.12);color:var(--text);
        padding:12px 14px;border-radius:12px;outline:none;min-width:min(360px,88vw)
      }
      .go{margin-left:8px}
      /* Flowers (hero + page2 reuse) */
      .flowers,.petals{position:fixed;inset:0;pointer-events:none;z-index:0}
      .petal{
        position:absolute;width:18px;height:24px;border-radius:60% 60% 60% 60%/70% 70% 40% 40%;
        background:radial-gradient(circle at 30% 30%,#fff8,transparent 60%),#ff8fcf;
        box-shadow:0 2px 8px rgba(0,0,0,.25);opacity:.9;animation:fall linear forwards;
      }
      @keyframes fall{to{transform:translate3d(var(--tx),105vh,0) rotate(var(--rot));opacity:.95}}
      /* Balloons */
      .balloons{position:fixed;inset:0;pointer-events:none;z-index:0}
      .balloon{
        position:absolute;width:70px;height:90px;border-radius:40px 40px 45px 45px;display:block;opacity:.85;
        box-shadow:inset -10px -16px 24px rgba(0,0,0,.18),0 8px 24px rgba(0,0,0,.18)
      }
      .balloon:after{
        content:"";position:absolute;left:50%;transform:translateX(-50%);bottom:-22px;width:2px;height:26vh;background:rgba(255,255,255,.25)
      }
      .balloon:before{
        content:"";position:absolute;left:50%;transform:translateX(-50%);bottom:-8px;width:18px;height:12px;background:inherit;filter:brightness(.9);border-radius:4px
      }
      /* Cake (same as before) */
      #cake{display:block;position:relative;margin:2rem auto 0 auto}
      .candle{background:#fff;border-radius:10px;position:absolute;top:228px;left:50%;margin-left:-2.4px;margin-top:-8.33px;width:5px;height:35px;transform:translateY(-300px);backface-visibility:hidden;animation:in 500ms 2.2s ease-out forwards}
      .candle:after,.candle:before{background:rgba(255,0,0,.4);content:"";position:absolute;width:100%;height:2.22px}
      .candle:after{top:25%}.candle:before{top:45%}
      .fire{border-radius:100%;position:absolute;top:-20px;left:50%;margin-left:-2.6px;width:6.66px;height:18px}
      .fire:nth-child(1){animation:fire 2s 2.4s infinite}.fire:nth-child(2){animation:fire 1.5s 2.4s infinite}
      .fire:nth-child(3){animation:fire 1s 2.4s infinite}.fire:nth-child(4){animation:fire .5s 2.4s infinite}
      .fire:nth-child(5){animation:fire .2s 2.4s infinite}
      @keyframes fire{0%,100%{background:rgba(254,248,97,.5);box-shadow:0 0 40px 10px rgba(248,233,209,.2);transform:translateY(0) scale(1)}50%{background:rgba(255,50,0,.1);box-shadow:0 0 40px 20px rgba(248,233,209,.2);transform:translateY(-20px) scale(0)}}
      @keyframes in{to{transform:translateY(0)}}
      .text{color:#d1d1d1;font-family:"Lato","Poppins",sans-serif;font-weight:300;font-style:italic;text-align:center}
      .text h1{font-size:1.4em}
      .question{margin-top:24px;text-align:center}
      .opts{margin-top:10px;display:flex;gap:12px;justify-content:center}
      footer{padding:40px 0;text-align:center;color:var(--muted)}
      /* ====== EPIC GALLERY (screen3) ====== */
      #screen3{padding:0}
      .galleryWrap{
        position:fixed;inset:0;z-index:1;overflow:hidden; /* full-screen, no scroll */
      }
      .galleryLayer{position:absolute;inset:-10vh -10vw} /* little overscan for drift */
      .photo{
        position:absolute;display:block;object-fit:cover;border-radius:16px;
        box-shadow:0 10px 40px rgba(0,0,0,.35);
        will-change:transform,opacity;user-select:none;pointer-events:none;
      }
      .photo.small{width:14vw;height:18vh}
      .photo.med{width:18vw;height:24vh}
      .photo.large{width:24vw;height:32vh}
      .shine{
        position:absolute;inset:0;border-radius:inherit;pointer-events:none;
        background:radial-gradient(120% 120% at 0% 0%,rgba(255,255,255,.18),transparent 60%);
        mix-blend-mode:screen;opacity:.65;filter:blur(.2px)
      }
      .hbText{
        position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
        font-family:"Great Vibes",cursive;font-size:clamp(40px,9vw,140px);
        background:linear-gradient(90deg,var(--gold),#fff,var(--blue));-webkit-background-clip:text;background-clip:text;color:transparent;
        text-align:center;filter:drop-shadow(0 6px 20px rgba(255,209,102,.18));
        white-space:nowrap;opacity:.9;pointer-events:none
      }
      .hbSub{
        position:absolute;left:50%;top:calc(50% + min(80px,12vw));transform:translateX(-50%);
        color:var(--muted);font-size:clamp(14px,2.6vw,20px);text-align:center;opacity:.9
      }
      .galleryControls{
        position:fixed;left:50%;bottom:18px;transform:translateX(-50%);z-index:3;
        display:flex;gap:10px;align-items:center
      }
      .pill{
        border-radius:999px;padding:10px 14px;border:1px solid rgba(255,255,255,.12);
        background:rgba(12,18,30,.6);backdrop-filter:blur(6px);color:var(--text);font-weight:700
      }
      .mutedNote{font-size:12px;color:var(--muted)}
      /* music prompt button on hero */
      .soundPrompt{
        margin-top:16px;display:inline-flex;gap:10px;align-items:center
      }
      .soundBtn{padding:10px 14px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:#0e1526;color:var(--text);cursor:pointer}
      .soundBtn.playing{background:linear-gradient(135deg,var(--pink),var(--blue));color:#0b0f1a;font-weight:800}
      /* prevent accidental text selection on draggy mobile */
      img,button{ -webkit-user-drag:none }
    </style>
  </head>
  <body>
    <canvas id="stars"></canvas>
    <canvas id="petalLayer"></canvas>

    <!-- Screen 1: Opening + name prompt -->
    <section id="screen1" class="screen active hero container">
      <div class="flowers" id="flowers"></div>
      <div>
        <h1 class="greeting hidden" id="g1">Happy Birthday, <span id="heroName"></span> ‚ú®</h1>
        <p class="subtitle hidden">From your loving Motherüòò</p>

        <div class="name-box" id="nameBox">
          <input id="nameInput" class="input" placeholder="Enter your name" maxlength="24"/>
          <button class="btn go" id="goBtn">Go ‚ûú</button>
        </div>
        <p class="subtitle" id="hint" style="display:none">(Press Enter after typing)</p>

        <div class="soundPrompt">
          <button id="soundToggle" class="soundBtn">Enable music üîä</button>
          <span class="mutedNote">Click to enable the music</span>
        </div>
      </div>
    </section>

    <!-- Screen 2: Letter + balloons + cake + question -->
    <section id="screen2" class="screen container section">
      <div class="balloons" id="balloons"></div>
      <div class="petals" id="petals"></div>

      <div class="card hidden">
        <h2 class="title">A Little Letter For You üíå</h2>
        <div id="longMsg" style="font-size:clamp(16px,2.5vw,20px);line-height:1.9">
          <p>Dear <strong id="dearName">Shreya</strong>,</p>
          <p>Happy bithday my darling daughter!</p>
          <p>You make our world kinder just by being in it. Keep chasing the things that set your heart on fire</p>
          <p>May you always find love and kindness in your journey.</p>
          <p>Make a wish, take up space, and never forget how loved you are. Happy Birthday! üéâ</p>
          <p>‚Äî With love, <em>Your Mother</em></p>
        </div>
      </div>

      <div class="card hidden" style="margin-top:20px">
        <div class="center" style="position:relative">
          <div class="candle">
            <div class="fire"></div><div class="fire"></div><div class="fire"></div><div class="fire"></div><div class="fire"></div>
          </div>
          <!-- SVG Cake (unchanged) -->
          <svg id="cake" version="1.1" x="0px" y="0px" width="200px" height="500px" viewBox="0 0 200 500" xml:space="preserve">
            <!-- (paths omitted for brevity ‚Äì keep exactly as your previous file) -->
            <!-- BEGIN SHORT CAKE: -->
            <path fill="#a88679" d="M173.667-13.94c-49.298,0-102.782,0-147.334,0c-3.999,0-4-16.002,0-16.002 c44.697,0,96.586,0,147.334,0C177.667-29.942,177.668-13.94,173.667-13.94z">
              <animate id="bizcocho_3" attributeName="d" calcMode="spline" keySplines="0 0 1 1; 0 0 1 1" begin="relleno_2.end" dur="0.3s" fill="freeze"
                values="M173.667-13.94c-49.298,0-102.782,0-147.334,0c-3.999,0-4-16.002,0-16.002 c44.697,0,96.586,0,147.334,0C177.667-29.942,177.668-13.94,173.667-13.94z; M173.667,411.567c-47.995,12.408-102.955,12.561-147.334,0 c-3.848-1.089-0.189-16.089,3.661-15.002c44.836,12.66,90.519,12.753,139.427,0.07 C173.293,395.631,177.541,410.566,173.667,411.567z; M173.667,427.569c-49.795,0-101.101,0-147.334,0c-3.999,0-4-16.002,0-16.002 c46.385,0,97.539,0,147.334,0C177.668,411.567,177.667,427.569,173.667,427.569z"/>
            </path>
            <path fill="#8b6a60" d="M100-178.521c1.858,0,3.364,1.506,3.364,3.363c0,0,0,33.17,0,44.227 c0,19.144,0,57.431,0,76.574c0,10.152,0,40.607,0,40.607c0,1.858-1.506,3.364-3.364,3.364l0,0c-1.858,0-3.364-1.506-3.364-3.364c0,0,0-30.455,0-40.607c0-19.144,0-57.432,0-76.575c0-11.057,0-44.226,0-44.226C96.636-177.015,98.142-178.521,100-178.521 L100-178.521z">
              <animate id="relleno_2" attributeName="d" calcMode="spline" keySplines="0 0 1 1; 0 0 1 1; 0 0 0.58 1" begin="bizcocho_2.end" dur="0.5s" fill="freeze"
                values="M100-178.521c1.858,0,3.364,1.506,3.364,3.363...; M102.242,427.569c5.348,0,14.079,0,17.462,0 c0,0,17.026,0,27.504,0 c19.143,0,20.39-3.797,26.459,0c3,1.877,0,7.823,0,7.823c-2.412,2.258-58.328,0-73.667,0l0,0c-1.858,0-67.187,0-73.667,0 c0,0-4.125-4.983,0-7.823c5.201-3.58,16.085,0,23.725,0c8.841,0,20.762,0,20.762,0c3.686,0,8.597,0,19.511,0H102.242z"/>
            </path>
            <!-- (keep remaining paths/rect from your original) -->
          </svg>
          <div class="text">
            <h1>happy birthday!</h1>
            <p id="cakeName">Shreya</p>
          </div>
        </div>

        <div class="question">
          <h3>How's the josh?</h3>
          <div class="opts">
            <button class="btn" data-josh="good">Good üòÑ</button>
            <button class="btn secondary" data-josh="not">Not good üòå</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Screen 3: FULLSCREEN EPIC GALLERY -->
    <section id="screen3" class="screen">
      <div class="galleryWrap" aria-hidden="true">
        <div class="galleryLayer" id="gallery"></div>
        <div class="hbText">Happy Birthday <span id="hbName">Shreya</span> ‚ú®</div>
        <div class="hbSub">From your mother ‚Äî with all our favorite memories</div>
      </div>

      <div class="galleryControls">
        <button class="pill btn" id="moreConfetti">Confetti üéä</button>
        <button class="pill btn secondary" id="nextBtn">Next page ‚ûú</button>
        <span class="pill mutedNote" id="musicState">Music: off</span>
      </div>
    </section>

    <!-- Screen 4: Finale -->
    <section id="screen4" class="screen container section center">
      <div class="card">
        <h2>One last thing, <span id="finalName">Shreya</span>‚Ä¶ üëÄ</h2>
        <p style="font-size:1.1rem;color:var(--muted);max-width:60ch">
          Thank you for everything that you've done.We're lucky to have you .Baba would have been proud of you today.
          I wish you success for lifetime.We love you alot. Happy Birthday MAAüíñüíìüíû‚ù£Ô∏è ‚ú®
        </p>
        <div class="center" style="margin-top:16px">
          <button class="btn secondary" onclick="location.hash='#screen1'">Replay intro</button>
        </div>
      </div>
    </section>

    <footer>Made with ‚ù§Ô∏è by your Mother ¬∑ <span id="year"></span></footer>

    <!-- Music (loop) -->
    <audio id="music" loop preload="auto">
      <source src="./assets/happy-birthday-357371.mp3" type="audio/mpeg"/>
    </audio>

    <script>
      // ========= CONFIG =========
      const IMGS = [
        // Put your 21 images in /assets and adjust names if needed:
        "./assets/1.jpg","./assets/2.jpg","./assets/3.png","./assets/5.png","./assets/6.png","./assets/7.jpg","./assets/8.png",
        "./assets/9.png","./assets/IMG-20231025-WA0078.jpg","./assets/IMG-20240130-WA0031(1).jpg","./assets/IMG-20240130-WA0045(1).jpg","./assets/IMG-20240130-WA0058(2).jpg","./assets/IMG-20240214-WA0005.jpg",
        "./assets/IMG-20240219-WA0036.jpg","./assets/IMG-20240401-WA0047.jpg","./assets/IMG-20250227-WA0031.jpg","./assets/IMG-20250413-WA0039.jpg","./assets/IMG-20250501-WA0022.jpg","./assets/IMG-20250813-WA0104.jpg",
        "./assets/IMG-20250813-WA0105.jpg","./assets/Screenshot_20250813-221937.png"
      ];
      const MUSIC_SRC = "./assets/happy-birthday-357371.mp3"; // change if your file name differs

      // ========= HELPERS =========
      const $ = (q, ctx = document) => ctx.querySelector(q);
      const $$ = (q, ctx = document) => [...ctx.querySelectorAll(q)];
      const screens = ["screen1","screen2","screen3","screen4"];
      const setName = (name)=>localStorage.setItem("shreya_name",name);
      const getName = ()=>localStorage.getItem("shreya_name")||"Shreya";
      const setJosh = (v)=>localStorage.setItem("shreya_josh",v);
      function show(id){
        screens.forEach(s=>$("#"+s)?.classList.toggle("active", s===id));
        location.hash = id; window.scrollTo(0,0);
        if(id==="screen2") animatePage2();
        if(id==="screen3") startGallery();
      }
      window.addEventListener("hashchange",()=> show(location.hash.replace("#","")||"screen1"));

      // ========= STARS BG =========
      function initStars(){
        const c=$("#stars"), dpr=Math.min(devicePixelRatio||1,2), x=c.getContext("2d");
        function rs(){ c.width=innerWidth*dpr; c.height=innerHeight*dpr; } rs();
        addEventListener("resize",rs);
        const stars=new Array(160).fill(0).map(()=>({x:Math.random()*c.width,y:Math.random()*c.height,r:(Math.random()*1.5+0.5)*dpr,s:Math.random()*0.6+0.2}));
        (function draw(){
          x.clearRect(0,0,c.width,c.height);
          for(const st of stars){
            x.globalAlpha=0.6; x.fillStyle="#9be7ff"; x.beginPath(); x.arc(st.x,st.y,st.r,0,Math.PI*2); x.fill();
            st.y+=st.s; if(st.y>c.height) st.y=-5;
          }
          requestAnimationFrame(draw);
        })();
      }

      // ========= FLOWERS + PETALS =========
      function flowersIntro(){
        const wrap=$("#flowers"); wrap.innerHTML="";
        for(let i=0;i<80;i++){
          const p=document.createElement("span"); p.className="petal";
          const x=Math.random()*100, delay=Math.random()*1.2, tx=(Math.random()*60-30)+"vw", rot=(Math.random()*720-360)+"deg";
          p.style.left=x+"vw"; p.style.top="-10vh"; p.style.setProperty("--tx",tx); p.style.setProperty("--rot",rot);
          p.style.animationDuration=6+Math.random()*3+"s"; p.style.animationDelay=delay+"s"; wrap.appendChild(p);
        }
      }
      function petalsRain(){
        const wrap=$("#petalLayer"), dpr=Math.min(devicePixelRatio||1,2), x=wrap.getContext("2d");
        function rs(){ wrap.width=innerWidth*dpr; wrap.height=innerHeight*dpr; } rs(); addEventListener("resize",rs);
        const parts=new Array(60).fill(0).map(()=>({
          x:Math.random()*wrap.width, y:Math.random()*wrap.height*-1, s:Math.random()*0.6+0.3, r:Math.random()*10, w:12*dpr, h:16*dpr
        }));
        (function draw(){
          x.clearRect(0,0,wrap.width,wrap.height);
          for(const p of parts){
            x.save(); x.translate(p.x,p.y); x.rotate(p.r/57.3);
            const grd=x.createRadialGradient(0,0,0,0,0,Math.max(p.w,p.h));
            grd.addColorStop(0,"rgba(255,255,255,.5)"); grd.addColorStop(1,"#ff9bcd");
            x.fillStyle=grd; x.beginPath(); x.ellipse(0,0,p.w,p.h,0,0,Math.PI*2); x.fill(); x.restore();
            p.y += 0.7 + p.s; p.r += 1.2; if(p.y>wrap.height+40) p.y = -Math.random()*200;
          }
          requestAnimationFrame(draw);
        })();
      }

      // ========= BALLOONS =========
      function seedBalloons(){
        const wrap=$("#balloons"); wrap.innerHTML="";
        const colors=["#ff6ec7","#7df9ff","#ffd166","#b8f7d4","#a0e7e5","#ffd1dc"];
        const count=18;
        for(let i=0;i<count;i++){
          const b=document.createElement("span"); b.className="balloon";
          b.style.left=Math.random()*100+"vw"; b.style.bottom="-12vh"; b.style.background=colors[i%colors.length];
          const scale=(Math.random()*0.6+0.7).toFixed(2); b.style.transform=`scale(${scale})`; wrap.appendChild(b); floatBalloon(b);
        }
      }
      function floatBalloon(el){
        const duration=gsap.utils.random(10,18), xDrift=gsap.utils.random(-40,40);
        gsap.set(el,{y:0}); gsap.to(el,{y:"-120vh",x:`+=${xDrift}`,duration,ease:"sine.inOut",repeat:-1,delay:Math.random()*5});
      }

      // ========= CONFETTI =========
      function burstConfetti(times=1){
        const end = Date.now() + times * 300;
        (function frame(){
          confetti({ particleCount: 10, angle: 60, spread: 70, origin: { x: 0 }});
          confetti({ particleCount: 10, angle: 120, spread: 70, origin: { x: 1 }});
          if(Date.now()<end) requestAnimationFrame(frame);
        })();
      }

      // ========= INTRO REVEAL =========
      function revealIntro(){
        gsap.to(["#g1 + .subtitle"],{opacity:1,y:0,duration:.8,delay:.2});
        setTimeout(()=>{
          $("#nameBox").style.display="inline-flex"; $("#hint").style.display="block";
          gsap.fromTo("#nameBox",{opacity:0,y:10},{opacity:1,y:0,duration:.6});
        },2600);
      }

      // ========= NAME / ROUTING =========
      function goNext(){
        let name=($("#nameInput").value||"").trim(); if(!name) name="Shreya";
        setName(name); updateNames(); burstConfetti(10); setTimeout(()=>show("screen2"),600);
      }
      function updateNames(){
        const nm=getName();
        $("#heroName").textContent=nm; $("#dearName").textContent=nm; $("#cakeName").textContent=nm;
        $("#finalName").textContent=nm; $("#hbName").textContent=nm;
      }

      // ========= PAGE 2 ENTER =========
      function animatePage2(){
        seedBalloons(); gsap.to($$("#screen2 .card.hidden"),{opacity:1,y:0,duration:.8,stagger:.12,ease:"power2.out"});
      }

      // ========= MUSIC =========
      const musicEl = $("#music");
      const soundToggle = $("#soundToggle");
      const musicState = $("#musicState");
      let musicEnabled = false;

      async function tryPlayMusic(){
        try{
          if(musicEl.src !== location.origin + "/" + MUSIC_SRC && !MUSIC_SRC.startsWith("http")){
            // set src if not absolute (helps on some hosts)
            musicEl.src = MUSIC_SRC;
          }
          await musicEl.play();
          musicEnabled = true;
          soundToggle?.classList.add("playing");
          soundToggle.textContent = "Music playing üéµ";
          musicState.textContent = "Music: on";
        }catch(e){
          musicEnabled = false;
          soundToggle?.classList.remove("playing");
          soundToggle.textContent = "Enable music üîä";
          musicState.textContent = "Music: off";
        }
      }
      soundToggle?.addEventListener("click", tryPlayMusic);
      document.addEventListener("visibilitychange", ()=>{
        if(document.hidden){ musicEl.pause(); } else if(musicEnabled){ musicEl.play().catch(()=>{}); }
      });

      // ========= EPIC GALLERY =========
      let galleryStarted=false;
      function preloadImages(srcs){
        return Promise.all(srcs.map(src => new Promise(res=>{
          const img=new Image(); img.onload=()=>res(); img.onerror=()=>res(); img.src=src;
        })));
      }
      function randomBetween(a,b){ return a + Math.random()*(b-a); }
      function startGallery(){
        if(galleryStarted) return; galleryStarted=true;

        preloadImages(IMGS).then(()=>{
          const layer = $("#gallery");
          layer.innerHTML = "";

          // create photo nodes
          IMGS.forEach((src,i)=>{
            const img = document.createElement("img");
            img.src = src; img.alt = "mem-"+(i+1);
            img.className = "photo " + (i%3===0 ? "large" : i%3===1 ? "med" : "small");
            // random start positions
            img.style.left = randomBetween(-5, 85) + "vw";
            img.style.top  = randomBetween(-5, 80) + "vh";
            img.style.rotate = randomBetween(-8,8) + "deg";
            img.style.opacity = 0;

            const shine = document.createElement("span");
            shine.className="shine";
            img.appendChild(shine); // aesthetic overlay

            layer.appendChild(img);

            // entrance
            gsap.to(img, {opacity:1, duration:1, delay: i*0.05, ease:"power2.out"});
            // floating path loop
            floatPhoto(img);
          });

          // occasional confetti
          setTimeout(()=>burstConfetti(8), 800);
          setInterval(()=>burstConfetti(4), 6000);
          // ensure music starts (user likely interacted by now)
          tryPlayMusic();
        });
      }

      function floatPhoto(el){
        const dur = randomBetween(10,18);
        const driftX = randomBetween(-30, 30);
        const driftY = randomBetween(-20, 20);
        const rot = randomBetween(-12, 12);
        gsap.to(el, {
          x: `+=${driftX}vw`, y: `+=${driftY}vh`, rotate: `+=${rot}deg`,
          duration: dur, ease: "sine.inOut", yoyo: true, repeat: -1
        });
        // soft scale pulse
        gsap.to(el, {scale: randomBetween(1.02,1.08), duration: randomBetween(2,3.5), ease:"sine.inOut", yoyo:true, repeat:-1});
      }

      // ========= JOSH BUTTONS -> page3 =========
      function handleJosh(){
        $$("#screen2 [data-josh]").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const v=btn.dataset.josh; setJosh(v);
            burstConfetti(8); show("screen3");
          });
        });
      }

      // ========= INIT =========
      window.addEventListener("DOMContentLoaded", ()=>{
        $("#year").textContent = new Date().getFullYear();
        initStars(); petalsRain(); flowersIntro(); updateNames();
        gsap.to($$("#screen1 .hidden"),{opacity:1,y:0,duration:.8,stagger:.12,ease:"power2.out"}); revealIntro();

        $("#goBtn").addEventListener("click", goNext);
        $("#nameInput").addEventListener("keydown", e=>{ if(e.key==="Enter") goNext(); });
        handleJosh();

        // routing
        const initial = location.hash.replace("#","") || "screen1";
        show(initial);

        // screen3 controls
        $("#moreConfetti")?.addEventListener("click", ()=>burstConfetti(12));
        $("#nextBtn")?.addEventListener("click", ()=>{ show("screen4"); burstConfetti(6); });
      });
    </script>
  </body>
</html>

